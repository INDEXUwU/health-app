<!DOCTYPE html>
<html lang="ja">

<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>繝励Ο繝輔ぅ繝ｼ繝ｫ逋ｻ骭ｲ | 蛛･蠎ｷ邂｡逅・い繝励Μ</title>

    <!-- 繝輔か繝ｳ繝茨ｼ・ogin / register 縺ｨ邨ｱ荳・・-->
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@400;700&display=swap" rel="stylesheet">

    <style>
        body {
            font-family: 'Noto Sans JP', sans-serif;
            background: linear-gradient(to bottom right, #c8f3d6, #d9f5c4);
            margin: 0;
            padding: 0;
            min-height: 100vh;

            display: flex;
            justify-content: center;
            align-items: center;
        }

        /* ---- 荳ｭ螟ｮ繧ｫ繝ｼ繝・---- */
        .container {
            background-color: #fff;
            width: 350px;
            padding: 40px 30px;
            border-radius: 20px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
            text-align: center;
        }

        h2 {
            color: #2e7d32;
            margin-bottom: 25px;
            font-size: 24px;
            font-weight: bold;
        }

        label {
            display: block;
            text-align: left;
            margin-bottom: 5px;
            font-size: 14px;
            color: #2e7d32;
        }

        input,
        select {
            width: 100%;
            padding: 10px 12px;
            border: 1px solid #ccc;
            border-radius: 8px;
            font-size: 14px;
            margin-bottom: 15px;
            box-sizing: border-box;
        }

        button {
            width: 100%;
            padding: 12px;
            background-color: #4caf50;
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            cursor: pointer;
            margin-top: 10px;
        }

        button:hover {
            background-color: #43a047;
        }

        #messageBox {
            margin-top: 15px;
            font-size: 14px;
            font-weight: bold;
        }

        .success {
            color: #2e7d32;
        }

        .error {
            color: #d32f2f;
        }
    </style>
</head>

<body>

    <div class="container">
        <form id="profileForm">
            <h2 id="formTitle">繝励Ο繝輔ぅ繝ｼ繝ｫ逋ｻ骭ｲ</h2>

            <label for="age">蟷ｴ鮨｢</label>
            <input type="number" id="age" name="age" min="0" />

            <label for="gender">諤ｧ蛻･</label>
            <select id="gender" name="gender">
                <option value="">驕ｸ謚槭＠縺ｦ縺上□縺輔＞</option>
                <option value="逕ｷ諤ｧ">逕ｷ諤ｧ</option>
                <option value="螂ｳ諤ｧ">螂ｳ諤ｧ</option>
                <option value="縺昴・莉・>縺昴・莉・/option>
            </select>

            <label for="height">霄ｫ髟ｷ (cm)</label>
            <input type="number" id="height" name="height" step="0.01" min="0" />

            <label for="weight">菴馴㍾ (kg)</label>
            <input type="number" id="weight" name="weight" step="0.01" min="0" />

            <label for="target_weight">逶ｮ讓吩ｽ馴㍾ (kg)</label>
            <input type="number" id="target_weight" name="target_weight" step="0.01" min="0" />

            <button type="submit" id="submitButton">逋ｻ骭ｲ</button>

            <div id="messageBox"></div>
        </form>
    </div>

    <script>
        const apiBase = "";
        const login_id = localStorage.getItem("login_id");
        const form = document.getElementById("profileForm");
        const messageBox = document.getElementById("messageBox");
        const submitButton = document.getElementById("submitButton");
        const formTitle = document.getElementById("formTitle");

        if (!login_id) {
            alert("繝ｭ繧ｰ繧､繝ｳ縺励※縺上□縺輔＞縲・);
            window.location.href = "login.html";
        }

        // 譌｢蟄倥ョ繝ｼ繧ｿ蜿門ｾ・
        (async () => {
            try {
                const res = await fetch(`${apiBase}/api/user-info/${login_id}`);
                if (res.ok) {
                    const profile = await res.json();

                    document.getElementById("age").value = profile.age ?? "";
                    document.getElementById("gender").value = profile.gender ?? "";
                    document.getElementById("height").value = profile.height ?? "";
                    document.getElementById("weight").value = profile.weight ?? "";
                    document.getElementById("target_weight").value = profile.target_weight ?? "";

                    submitButton.textContent = "譖ｴ譁ｰ縺吶ｋ";
                    formTitle.textContent = "繝励Ο繝輔ぅ繝ｼ繝ｫ譖ｴ譁ｰ";
                }
            } catch (err) {
                console.error("蜿門ｾ励お繝ｩ繝ｼ:", err);
            }
        })();

        // 騾∽ｿ｡蜃ｦ逅・
        form.addEventListener("submit", async (e) => {
            e.preventDefault();

            const age = Number(document.getElementById("age").value);
            const gender = document.getElementById("gender").value;
            const height = Number(document.getElementById("height").value);
            const weight = Number(document.getElementById("weight").value);
            const target_weight = Number(document.getElementById("target_weight").value);

            try {
                const res = await fetch(`${apiBase}/api/user-info`, {
                    method: "POST",
                    headers: { "Content-Type": "application/json" },
                    body: JSON.stringify({
                        login_id,
                        age,
                        gender,
                        height,
                        weight,
                        target_weight
                    })
                });

                const data = await res.json();

                if (res.ok) {
                    messageBox.textContent = data.message;
                    messageBox.className = "success";

                    setTimeout(() => {
                        window.location.href = "home.html";
                    }, 900);
                } else {
                    messageBox.textContent = data.message || "繧ｨ繝ｩ繝ｼ";
                    messageBox.className = "error";
                }
            } catch (err) {
                console.error("騾∽ｿ｡繧ｨ繝ｩ繝ｼ:", err);
                messageBox.textContent = "繧ｵ繝ｼ繝舌・繧ｨ繝ｩ繝ｼ";
                messageBox.className = "error";
            }
        });
    </script>
</body>

</html>
